<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country Guesser - Europe Map</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 36px;
        }

        .game-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            flex-wrap: wrap;
        }

        .score-display {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 24px;
            font-weight: bold;
        }

        .question {
            font-size: 28px;
            color: #333;
            font-weight: bold;
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .map-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        #map-canvas {
            width: 100%;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            display: block;
        }

        .countries-list {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-height: 800px;
            overflow-y: auto;
        }

        .countries-list h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
            position: sticky;
            top: 0;
            background: white;
            padding: 10px 0;
            z-index: 10;
        }

        .country-btn {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 8px;
            font-size: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            text-align: left;
        }

        .country-btn:hover:not(:disabled) {
            background: #f5f5f5;
            border-color: #667eea;
            transform: translateX(5px);
        }

        .country-btn.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
            animation: pulse 0.5s ease;
        }

        .country-btn.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
            animation: shake 0.5s ease;
        }

        .country-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: white;
            padding: 40px 60px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            font-size: 32px;
            font-weight: bold;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .feedback.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .feedback.correct {
            color: #4caf50;
            border: 5px solid #4caf50;
        }

        .feedback.wrong {
            color: #f44336;
            border: 5px solid #f44336;
        }

        .btn-next {
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            font-size: 18px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background: #667eea;
            color: white;
            font-weight: bold;
            transition: 0.3s;
            display: none;
        }

        .btn-next.show {
            display: block;
        }

        .btn-next:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .countries-list {
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç Country Guesser - Europe Edition</h1>
            <div class="game-info">
                <div class="score-display">Scor: <span id="score">0</span></div>
                <div class="question">GƒÉse»ôte: <span id="country-name">---</span></div>
            </div>
        </div>

        <div class="main-content">
            <div class="map-container">
                <canvas id="map-canvas" width="1000" height="800"></canvas>
            </div>

            <div class="countries-list">
                <h3>üìç SelecteazƒÉ »öara</h3>
                <div id="country-buttons"></div>
                <button class="btn-next" id="btn-next" onclick="loadNewCountry()">‚Üí UrmƒÉtoarea »öarƒÉ</button>
            </div>
        </div>
    </div>

    <div class="feedback" id="feedback"></div>

    <script>
        const canvas = document.getElementById('map-canvas');
        const ctx = canvas.getContext('2d');

        let currentCountry = '';
        let currentScore = 0;
        let isWaiting = false;
        let countries = [];
        let countryRegions = {};

        // Define»ôte regiunile »õƒÉrilor (coordonate aproximative pentru clickable areas)
        const countryCoordinates = {
            "Iceland": {x: 100, y: 100, w: 80, h: 60},
            "Norway": {x: 300, y: 50, w: 100, h: 250},
            "Sweden": {x: 380, y: 80, w: 90, h: 280},
            "Finland": {x: 480, y: 70, w: 120, h: 200},
            "Russia": {x: 620, y: 50, w: 350, h: 400},
            "Estonia": {x: 520, y: 180, w: 60, h: 40},
            "Latvia": {x: 510, y: 225, w: 70, h: 45},
            "Lithuania": {x: 490, y: 275, w: 70, h: 40},
            "Belarus": {x: 550, y: 280, w: 110, h: 80},
            "Ukraine": {x: 560, y: 360, w: 180, h: 120},
            "Moldova": {x: 600, y: 420, w: 50, h: 55},
            "Romania": {x: 540, y: 450, w: 90, h: 70},
            "Bulgaria": {x: 550, y: 525, w: 80, h: 50},
            "Greece": {x: 500, y: 580, w: 90, h: 100},
            "Turkey": {x: 600, y: 600, w: 150, h: 90},
            "Cyprus": {x: 680, y: 680, w: 40, h: 25},
            "Albania": {x: 480, y: 560, w: 45, h: 60},
            "North Macedonia": {x: 500, y: 560, w: 50, h: 40},
            "Serbia": {x: 495, y: 500, w: 55, h: 60},
            "Montenegro": {x: 475, y: 520, w: 35, h: 35},
            "Bosnia and Herzegovina": {x: 465, y: 485, w: 55, h: 50},
            "Croatia": {x: 440, y: 460, w: 65, h: 65},
            "Slovenia": {x: 420, y: 455, w: 40, h: 35},
            "Hungary": {x: 470, y: 430, w: 80, h: 50},
            "Slovakia": {x: 470, y: 405, w: 70, h: 35},
            "Czech Republic": {x: 415, y: 405, w: 60, h: 40},
            "Austria": {x: 405, y: 440, w: 65, h: 40},
            "Poland": {x: 465, y: 350, w: 100, h: 70},
            "Germany": {x: 340, y: 360, w: 110, h: 100},
            "Switzerland": {x: 360, y: 455, w: 45, h: 40},
            "Liechtenstein": {x: 385, y: 455, w: 10, h: 10},
            "Italy": {x: 380, y: 500, w: 90, h: 150},
            "San Marino": {x: 420, y: 530, w: 8, h: 8},
            "Vatican City": {x: 410, y: 560, w: 6, h: 6},
            "Malta": {x: 415, y: 665, w: 15, h: 12},
            "France": {x: 240, y: 430, w: 120, h: 130},
            "Monaco": {x: 340, y: 525, w: 8, h: 8},
            "Andorra": {x: 265, y: 520, w: 10, h: 10},
            "Spain": {x: 150, y: 500, w: 150, h: 130},
            "Portugal": {x: 90, y: 520, w: 65, h: 110},
            "United Kingdom": {x: 220, y: 330, w: 90, h: 110},
            "Ireland": {x: 180, y: 345, w: 50, h: 70},
            "Belgium": {x: 310, y: 385, w: 35, h: 30},
            "Netherlands": {x: 315, y: 360, w: 40, h: 35},
            "Luxembourg": {x: 320, y: 410, w: 15, h: 15},
            "Denmark": {x: 340, y: 320, w: 50, h: 55},
            "Kosovo": {x: 500, y: 540, w: 30, h: 30},
            "Armenia": {x: 760, y: 560, w: 45, h: 40},
            "Georgia": {x: 720, y: 540, w: 50, h: 45},
            "Azerbaijan": {x: 780, y: 550, w: 60, h: 50},
            "Kazakhstan": {x: 850, y: 450, w: 120, h: 100}
        };

        // √éncarcƒÉ »õƒÉrile
        fetch('/get-country')
            .then(response => response.json())
            .then(data => {
                loadCountriesList();
                drawMap();
                loadNewCountry();
            });

        // DeseneazƒÉ harta
        function drawMap() {
            // Background
            ctx.fillStyle = '#e3f2fd';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // DeseneazƒÉ toate »õƒÉrile
            ctx.fillStyle = '#bdbdbd';
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;

            for (const [country, coords] of Object.entries(countryCoordinates)) {
                ctx.fillRect(coords.x, coords.y, coords.w, coords.h);
                ctx.strokeRect(coords.x, coords.y, coords.w, coords.h);
            }
        }

        // DetecteazƒÉ click pe hartƒÉ
        canvas.addEventListener('click', function(e) {
            if (isWaiting) return;

            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;

            // VerificƒÉ pe ce »õarƒÉ s-a dat click
            for (const [country, coords] of Object.entries(countryCoordinates)) {
                if (x >= coords.x && x <= coords.x + coords.w &&
                    y >= coords.y && y <= coords.y + coords.h) {
                    // GƒÉsit »õara
                    const btn = Array.from(document.querySelectorAll('.country-btn'))
                        .find(b => b.textContent === country);
                    if (btn && !btn.disabled) {
                        checkAnswer(country, btn);
                    }
                    break;
                }
            }
        });

        // √éncarcƒÉ lista de »õƒÉri
        function loadCountriesList() {
            countries = Object.keys(countryCoordinates).sort();
            createCountryButtons(countries);
        }

        // CreeazƒÉ butoanele
        function createCountryButtons(countryList) {
            const container = document.getElementById('country-buttons');
            container.innerHTML = '';

            countryList.forEach(country => {
                const btn = document.createElement('button');
                btn.className = 'country-btn';
                btn.textContent = country;
                btn.onclick = () => checkAnswer(country, btn);
                container.appendChild(btn);
            });
        }

        // √éncarcƒÉ »õarƒÉ nouƒÉ
        function loadNewCountry() {
            document.querySelectorAll('.country-btn').forEach(btn => {
                btn.classList.remove('correct', 'wrong');
                btn.disabled = false;
            });

            document.getElementById('btn-next').classList.remove('show');
            drawMap();

            fetch('/get-country')
                .then(response => response.json())
                .then(data => {
                    currentCountry = data.country;
                    document.getElementById('country-name').textContent = currentCountry;
                    isWaiting = false;
                });
        }

        // VerificƒÉ rƒÉspunsul
        function checkAnswer(clickedCountry, buttonElement) {
            if (isWaiting) return;
            isWaiting = true;

            document.querySelectorAll('.country-btn').forEach(btn => {
                btn.disabled = true;
            });

            fetch('/check-answer', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({answer: clickedCountry})
            })
            .then(response => response.json())
            .then(data => {
                currentScore = data.score;
                document.getElementById('score').textContent = currentScore;

                const feedbackDiv = document.getElementById('feedback');
                const btnNext = document.getElementById('btn-next');

                if (data.correct) {
                    buttonElement.classList.add('correct');
                    feedbackDiv.textContent = '‚úì Corect! +10 puncte';
                    feedbackDiv.className = 'feedback correct show';

                    // ColoreazƒÉ »õara pe hartƒÉ √Æn verde
                    const coords = countryCoordinates[clickedCountry];
                    if (coords) {
                        ctx.fillStyle = '#4caf50';
                        ctx.fillRect(coords.x, coords.y, coords.w, coords.h);
                        ctx.strokeRect(coords.x, coords.y, coords.w, coords.h);
                    }
                } else {
                    buttonElement.classList.add('wrong');
                    feedbackDiv.textContent = '‚úó Gre»ôit! Era ' + data.correct_answer;
                    feedbackDiv.className = 'feedback wrong show';

                    // ColoreazƒÉ »õara gre»ôitƒÉ √Æn ro»ôu
                    const wrongCoords = countryCoordinates[clickedCountry];
                    if (wrongCoords) {
                        ctx.fillStyle = '#f44336';
                        ctx.fillRect(wrongCoords.x, wrongCoords.y, wrongCoords.w, wrongCoords.h);
                        ctx.strokeRect(wrongCoords.x, wrongCoords.y, wrongCoords.w, wrongCoords.h);
                    }

                    // AratƒÉ »õara corectƒÉ
                    document.querySelectorAll('.country-btn').forEach(btn => {
                        if (btn.textContent === data.correct_answer) {
                            setTimeout(() => {
                                btn.classList.add('correct');
                                const correctCoords = countryCoordinates[data.correct_answer];
                                if (correctCoords) {
                                    ctx.fillStyle = '#4caf50';
                                    ctx.fillRect(correctCoords.x, correctCoords.y, correctCoords.w, correctCoords.h);
                                    ctx.strokeRect(correctCoords.x, correctCoords.y, correctCoords.w, correctCoords.h);
                                }
                            }, 500);
                        }
                    });
                }

                setTimeout(() => {
                    btnNext.classList.add('show');
                }, 1000);

                setTimeout(() => {
                    feedbackDiv.classList.remove('show');
                }, 3000);
            });
        }
    </script>
</body>
</html>